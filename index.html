<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Para Gaby üíñ</title>

  <!-- Tipograf√≠as -->
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Inter:wght@400;600&family=Great+Vibes&display=swap" rel="stylesheet" />

  <style>
    :root{
      /* tema por defecto (rosa) */
      --accent:#ff5c8f; --accent-2:#ffb0c8;
      --radius:16px;

      /* cupon */
      --ink:#3e1030;
      --chip:#ffe6ee; --chip-b:#ffd3e3;
      --panel:#fff6fb; --panel-b:#f6c0d6;
      --card-b:#f0e2f5;
      --glow:0 10px 30px rgba(255,92,143,.35);
    }
    body[data-theme="lila"]{ --accent:#a46bff; --accent-2:#d8c4ff; }
    body[data-theme="azul"]{ --accent:#3aa8ff; --accent-2:#bfe1ff; }
    body[data-theme="dorado"]{ --accent:#e2b427; --accent-2:#ffe8a6; }

    *{box-sizing:border-box}
    body{
      margin:0; background:#0b0b0b; color:#222; font-family:'Inter',sans-serif;
      min-height:100svh; display:flex; flex-direction:column; align-items:center;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      -webkit-tap-highlight-color: transparent;
    }

    /* ===== Fondo con video (temas cambiables) ===== */
    .bg{ position:fixed; inset:0; z-index:-2; }
    .bg video{ width:100%; height:100%; object-fit:cover; filter:brightness(.75); }
    .bg::after{
      content:""; position:absolute; inset:0;
      background:radial-gradient(circle at 50% 50%, color-mix(in oklab, var(--accent) 35%, transparent) 0%, transparent 70%);
    }

    /* ===== Corazones decorativos del fondo ===== */
    .hearts{ position:fixed; inset:0; pointer-events:none; z-index:-1; overflow:hidden; transition:.3s opacity; }
    .hearts.hide{ opacity:0; }
    .heart{
      position:absolute; width:var(--s,24px); height:var(--s,24px);
      transform: rotate(45deg); background:var(--accent); border-radius:6px; opacity:.65;
      filter: drop-shadow(0 3px 8px rgba(0,0,0,.25)) drop-shadow(0 0 14px color-mix(in oklab, var(--accent) 70%, transparent));
      animation: fall linear infinite;
    }
    .heart::before,.heart::after{ content:""; position:absolute; width:var(--s,24px); height:var(--s,24px); background:var(--accent); border-radius:50%; }
    .heart::before{ top:-50%; left:0; } .heart::after{ left:-50%; top:0; }
    @keyframes fall{
      0%{ transform: translate3d(0,-10%,0) rotate(45deg);}
      100%{ transform: translate3d(var(--dx,40px),110vh,0) rotate(45deg);}
    }

    /* ===== Encabezado ===== */
    header{ text-align:center; padding:24px 12px 12px; }
    header h1{
      font-family:'Cormorant Garamond',serif; color:#fff;
      font-size:clamp(1.5rem, 6vw, 2rem); margin:0; line-height:1.15;
    }
    header p{
      font-size:clamp(.9rem, 4vw, 1rem);
      background:rgba(255,255,255,.85); display:inline-block; padding:6px 12px;
      border-radius:999px; margin-top:8px;
    }

    /* ===== Foto ===== */
    .frame{ width:92%; max-width:420px; margin:20px auto; }
    .frame img{
      width:100%; border-radius:12px; display:block; box-shadow:0 6px 16px rgba(0,0,0,.3);
    }
    figcaption{
      text-align:center; margin-top:8px; background:rgba(255,255,255,.92);
      padding:4px 10px; border-radius:999px; font-weight:700; font-size:.95rem;
    }

    /* ===== Mensaje ===== */
    .card{
      width:92%; max-width:500px; margin:14px auto; background:rgba(255,255,255,.94);
      border-radius:var(--radius); padding:18px; box-shadow:0 4px 12px rgba(0,0,0,.15);
    }
    .mensaje{
      font-family:'Cormorant Garamond',serif; font-size:clamp(1rem, 4vw, 1.25rem); line-height:1.6; margin:0;
    }
    .firma{
      margin-top:14px; font-family:'Great Vibes',cursive;
      font-size:clamp(1.2rem, 5vw, 1.6rem); color:var(--accent);
    }

    /* ===== Spotify ===== */
    .spotify{
      width:92%; max-width:500px; margin:20px auto; background:rgba(255,255,255,.96);
      border-radius:var(--radius); padding:14px; text-align:center;
    }
    .spotify h2{
      font-family:'Great Vibes',cursive; margin:0 0 10px;
      font-size:clamp(1.3rem, 5vw, 1.6rem); color:var(--accent);
    }
    .spotify iframe{ width:100%; height:220px; border-radius:12px; border:none; }
    .btn{
      display:inline-block; margin-top:10px; padding:10px 14px; border-radius:999px; font-weight:600; font-size:.95rem; text-decoration:none;
      background:linear-gradient(180deg, #fff, var(--accent-2)); color:#551a2a; box-shadow:0 4px 12px rgba(0,0,0,.2);
    }

    footer{ text-align:center; color:#fff; font-size:.9rem; margin:20px 0 84px; }

    /* ===== Botones flotantes ===== */
    .fab{
      position:fixed; bottom:16px; right:16px; display:flex; flex-direction:column; gap:10px; z-index:10;
      padding-right: env(safe-area-inset-right); padding-bottom: env(safe-area-inset-bottom);
    }
    .chip{
      border:none; border-radius:999px; padding:12px 16px; font-weight:700; font-size:.9rem;
      background:linear-gradient(180deg, #fff, var(--accent-2)); color:#551a2a; box-shadow:0 4px 12px rgba(0,0,0,.25);
    }

    @media (prefers-reduced-motion: reduce){
      .heart{ animation: none !important; }
    }

    /* ========= CUPON (modal) ========= */
    .cupon-modal{
      position:fixed; inset:0; display:none; place-items:center;
      background:rgba(0,0,0,.45); z-index:9999; padding:20px;
      animation: fadeBg .25s ease both;
    }
    .cupon-modal.is-open{ display:grid; }
    @keyframes fadeBg{ from{opacity:0} to{opacity:1} }

    /* ‚ú® animaci√≥n popIn del di√°logo */
    .cupon-dialog{
      position:relative;
      max-width:680px;
      width:100%;
      max-height:90vh;
      overflow-y:auto;
      border-radius:24px;
      background:#fff;
      box-shadow:0 24px 64px rgba(0,0,0,.3);
      border:1px solid var(--card-b);
      transform-origin:center;
      animation: popIn .38s cubic-bezier(.2,.8,.2,1) both;
    }
    @keyframes popIn{
      0%{ transform:scale(.92) translateY(8px); opacity:0 }
      100%{ transform:scale(1) translateY(0); opacity:1 }
    }

    .cupon-close{
      position:absolute; margin:12px; right:8px; top:4px;
      border:none; background:transparent; font-size:28px; cursor:pointer; line-height:1;
      color:#8a5a7b;
    }
    .cupon-header{
      padding:28px 24px 10px;
      background:linear-gradient(135deg,#fff 0%,#fff7ff 60%,#fff0f6 100%);
    }
    .cupon-chip{
      display:inline-block; background:var(--chip); border:1px solid var(--chip-b); color:#6f2346;
      font-weight:700; padding:6px 10px; border-radius:999px; font-size:12px; margin-bottom:8px;
      box-shadow: var(--glow);
    }
    #cupon-title{
      margin:0; font-size:32px; line-height:1.15;
      background:linear-gradient(90deg,#ff6fa9,#ffb06a,#6fd49a);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow:0 2px 0 rgba(255,255,255,.6);
    }
    .cupon-sub{ margin:6px 0 0; color:#6f4963; font-weight:700; letter-spacing:.2px }
    .cupon-body{ padding:16px 24px; position:relative; overflow:hidden; }
    .cupon-perks{
      display:grid; grid-template-columns:repeat(3,minmax(0,1fr));
      gap:10px; padding:0; margin:0 0 14px; list-style:none;
    }
    .cupon-perks li{
      text-align:center; background:#f8fff9; border:1px solid #e0f3e5;
      border-radius:12px; padding:10px 12px; font-size:14px;
    }
    .cupon-valid{
      display:flex; flex-wrap:wrap; gap:8px 14px; align-items:center;
      padding:12px 14px; border:1.5px dashed var(--panel-b); border-radius:12px; background:var(--panel); font-size:14px
    }
    .cupon-tag{ font-weight:800; background:var(--chip); border:1px solid var(--chip-b); border-radius:8px; padding:6px 10px }
    .cupon-date{ background:#fff; border:1px solid var(--card-b); border-radius:999px; padding:6px 10px; font-weight:600 }
    .cupon-serial{ margin-top:12px; font-family:ui-monospace,Menlo,Consolas,monospace; color:#7b5670 }

    /* üîí panel de desbloqueo */
    .unlock{
      margin:14px 0; padding:14px; border-radius:14px;
      background:linear-gradient(180deg,#fff,#fff7fb); border:1.5px dashed var(--chip-b);
      display:flex; align-items:center; gap:12px;
    }
    .unlock-btn{
      width:56px; height:56px; border-radius:50%; border:none; cursor:pointer;
      background:radial-gradient(circle at 30% 30%, #ff9fc1, var(--accent));
      position:relative; box-shadow:var(--glow);
      display:grid; place-items:center;
      animation: pulse 1.6s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{ transform:scale(1) } 50%{ transform:scale(1.06) }
    }
    .lock{
      width:22px; height:18px; background:#fff; border-radius:4px; position:relative; box-shadow:inset 0 0 0 2px #cc6e9a;
    }
    .lock::before{
      content:""; position:absolute; width:16px; height:14px; left:50%; top:-10px; transform:translateX(-50%);
      border:2px solid #cc6e9a; border-bottom:none; border-radius:10px 10px 0 0; background:transparent;
      transition: transform .35s ease;
    }
    .unlock-btn.open .lock::before{ transform:translateX(-50%) rotate(-35deg) translateX(4px); }
    .unlock-note{ font-weight:700; color:#6f2346; }
    .unlock-hint{ font-size:12px; color:#7b5670; margin-top:4px }

    .cupon-actions{ display:flex; gap:10px; padding:16px 24px 24px; flex-wrap:wrap; align-items:center }
    .cupon-primary{
      appearance:none; border:none; cursor:pointer; padding:12px 16px; border-radius:12px; font-weight:800;
      background:linear-gradient(90deg,#ff7ab3,#ffb567); color:var(--ink); box-shadow: var(--glow);
    }
    .cupon-primary[disabled]{ opacity:.6; cursor:not-allowed }

    .cupon-primary.loading{ cursor:progress; opacity:.85 }
    .cupon-primary.loading::after{
      content:""; display:inline-block; width:1em; height:1em; margin-left:.6em; vertical-align:-.2em;
      border-radius:50%; border:2px solid rgba(0,0,0,.2); border-top-color:rgba(0,0,0,.6); animation: spin .9s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(1turn) } }

    /* caja del codigo */
    .cupon-code{
      margin-top:14px; padding:14px; border-radius:14px;
      background:linear-gradient(180deg,#fff, #fff7fb);
      border:1.5px dashed var(--chip-b);
      box-shadow: 0 10px 24px rgba(0,0,0,.08), var(--glow);
      display:none;
    }
    .cupon-code.show{ display:block; animation: pop .45s ease both; }
    .cupon-code h3{ margin:0 0 8px; font-size:1rem; color:#6f2346; }
    .code-row{ display:flex; gap:10px; align-items:stretch; flex-wrap:wrap; }
    .code-input{
      flex:1; min-width:220px;
      font-family:ui-monospace,Menlo,Consolas,monospace; font-weight:800; letter-spacing:.5px;
      border:1px solid var(--card-b); border-radius:10px; padding:12px; background:#fff; color:#2a0d1f;
    }
    .copy-btn{
      border:none; border-radius:10px; padding:12px 14px; font-weight:800; cursor:pointer;
      background:linear-gradient(90deg,#ffdce9,#ffe9b9); color:#4b1533; box-shadow: var(--glow);
    }
    .secret{ margin:.6rem 0 0; color:#7a4b67; font-size:.9rem; font-style:italic }

    @keyframes pop{
      0%{ transform:translateY(8px) scale(.98); opacity:0 }
      100%{ transform:translateY(0) scale(1); opacity:1 }
    }

    /* ====== EXPLOSIONES: corazones / confeti / p√©talos ====== */
    .mega-burst{
      position:fixed; inset:0; pointer-events:none; z-index:10000; overflow:hidden;
      display:none;
    }
    .mega-burst.show{ display:block; }
    .burst-heart,.burst-confetti,.burst-petal{
      position:absolute; opacity:0; animation: burst 1200ms ease-out forwards;
      will-change: transform, opacity;
    }
    /* corazones */
    .burst-heart{ width:12px; height:12px; transform: rotate(45deg); background:var(--accent); border-radius:3px; filter: drop-shadow(0 2px 6px rgba(0,0,0,.25)); }
    .burst-heart::before,.burst-heart::after{ content:""; position:absolute; width:12px; height:12px; background:var(--accent); border-radius:50%; }
    .burst-heart::before{ top:-50%; left:0 } .burst-heart::after{ left:-50%; top:0 }
    /* confeti pastel */
    .burst-confetti{ width:8px; height:14px; background:#ffd8e8; box-shadow:0 0 0 1px rgba(0,0,0,.04) inset; border-radius:2px; }
    .burst-confetti.c2{ background:#dff4ff } .burst-confetti.c3{ background:#eaf9df } .burst-confetti.c4{ background:#fff0cc }
    /* p√©talos sakura */
    .burst-petal{
      width:18px; height:12px; background:radial-gradient(60% 90% at 60% 40%, #ffe8f0 0%, #ffc1d7 60%, #ff9fbf 100%);
      border-radius:18px 18px 18px 2px; transform:rotate(20deg);
      filter: drop-shadow(0 2px 6px rgba(0,0,0,.15));
    }

    @keyframes burst{
      0%{ transform: translate(0,0) scale(.7); opacity:0 }
      10%{ opacity:1 }
      100%{ transform: translate(var(--tx), var(--ty)) rotate(var(--rot,0deg)) scale(1); opacity:0 }
    }

    /* ===== Interfaz de compartir ===== */
    .share-screen{
      display:none; padding:20px; text-align:center; border-top:1px solid var(--card-b);
      background:linear-gradient(180deg,#fff,#fff8fc);
    }
    .share-screen.show{ display:block; animation: pop .45s ease both; }
    .share-title{
      font-weight:800; margin:0 0 8px; color:#4b1533;
    }
    .share-sub{ margin:0 0 14px; color:#6f4963; }
    .share-actions{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center }

    .share-btn{
      border:none; border-radius:12px; padding:10px 14px; font-weight:800; cursor:pointer;
      background:linear-gradient(90deg,#ff7ab3,#ffb567); color:#3e1030; box-shadow: var(--glow);
    }
    .share-btn.ghost{ background:#fff; border:1.5px solid #eee2f2; }

    /* WhatsApp oficial (verde + logo) */
    .share-btn.whatsapp{
      display:inline-flex; align-items:center; gap:10px;
      background:linear-gradient(90deg,#25D366,#128C7E);
      color:#fff;
    }
    .share-btn.whatsapp svg{
      width:20px; height:20px; flex:0 0 20px;
      filter: drop-shadow(0 1px 0 rgba(0,0,0,.15));
    }

    /* üîò WhatsApp fijo dentro del modal (siempre visible) */
    .whats-fixed{
      position:sticky; bottom:0; left:0; right:0;
      background:linear-gradient(180deg,#ffffffE6,#fff);
      display:flex; justify-content:center; padding:12px;
      border-top:1px solid #efe2f2;
      z-index:5;
    }
    .whats-fixed .whatsapp{
      width:100%; max-width:520px;
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 16px; border-radius:14px;
    }

    /* ===== Mini modal: T√©rminos y Condiciones ===== */
    .terms-modal{
      position:fixed; inset:0; display:none; place-items:center;
      background:rgba(0,0,0,.45); z-index:10050; padding:20px;
      animation: fadeBg .25s ease both;
    }
    .terms-modal.is-open{ display:grid; }

    .terms-dialog{
      width:100%; max-width:520px; background:#fff; border-radius:18px;
      box-shadow:0 24px 64px rgba(0,0,0,.3); border:1px solid #efe2f2;
      overflow:hidden; transform-origin:center; animation: popIn .3s ease both;
    }
    .terms-head{ padding:18px 20px; background:linear-gradient(135deg,#fff,#fff7ff); }
    .terms-head h3{ margin:0; font-size:1.15rem; color:#5b2846; }
    .terms-body{ padding:16px 20px; color:#6f4963; font-size:.95rem; }
    .terms-actions{
      display:flex; gap:8px; padding:14px; justify-content:flex-end; border-top:1px solid #efe2f2;
      background:linear-gradient(180deg,#fff,#fff8fc);
    }
    .btn-ghost{
      border:1px solid #e6d9ec; background:#fff; color:#5b2846; border-radius:12px; padding:10px 14px; font-weight:800; cursor:pointer;
    }
    .btn-primary{
      border:none; background:linear-gradient(90deg,#ff7ab3,#ffb567); color:#3e1030; border-radius:12px; padding:10px 14px; font-weight:800; cursor:pointer; box-shadow: var(--glow);
    }

    /* Toast ‚Äúsolo ser√° v√°lido si son novios‚Äù */
    .tnc-toast{
      position:fixed; left:50%; bottom:22px; transform:translateX(-50%);
      background:#3e1030; color:#fff; padding:10px 14px; border-radius:999px; font-weight:700;
      box-shadow:0 8px 24px rgba(0,0,0,.25);
      opacity:0; pointer-events:none; transition:.25s opacity, .25s transform;
      z-index:11000;
      white-space:nowrap;
    }
    .tnc-toast.show{ opacity:1; transform:translateX(-50%) translateY(-4px); }
  </style>
</head>
<body data-theme="rosa">
  <!-- Fondo -->
  <div class="bg" aria-hidden="true">
    <video id="bgVideo" autoplay muted loop playsinline preload="auto" poster="imagenes/foto1.png">
      <source id="bgSrc" src="video/video1.mp4" type="video/mp4" />
    </video>
  </div>

  <!-- Corazones (se rellenan con JS) -->
  <div class="hearts" id="hearts" aria-hidden="true"></div>

  <header>
    <h1>Para mi ni√±a üíï</h1>
    <p>Un mensaje y un rinc√≥n para nuestra foto favorita.</p>
  </header>

  <figure class="frame">
    <img src="imagenes/foto1.png" alt="Foto con Gaby" loading="eager" decoding="async">
    <figcaption>Gaby &amp; Brayan</figcaption>
  </figure>

  <article class="card">
    <p class="mensaje">
      Mi Gaby, gracias por hacer que cada d√≠a se sienta como el mejor d√≠a de mi vida.
      Quiero seguir escribiendo esta historia contigo, con paciencia, risas y un amor sincero.
      Te amo y siempre ser√° as√≠: nunca me cansar√© de enamorarte; jam√°s volver√© a confiarme.
      Siempre ser√°s mi mujer y nunca me rendir√© de luchar por nuestro amor. Te amo, mi ni√±a guapa.
      <br><br><strong>TE AMO, PRECIOSA</strong>
    </p>
    <p class="firma">‚Äî De m√≠, para ti üíó</p>
  </article>

  <div class="spotify">
    <h2>Nuestra playlist del amor üíñ</h2>
    <iframe src="https://open.spotify.com/embed/playlist/6co4GiKxOGTxyYLkl0stn5?utm_source=generator"
            allow="autoplay; clipboard-write; encrypted-media; picture-in-picture" loading="lazy"></iframe>
    <a class="btn" href="https://open.spotify.com/playlist/6co4GiKxOGTxyYLkl0stn5" target="_blank" rel="noopener">Abrir en Spotify</a>
  </div>

  <footer>Hecho con üíó para mi Gaby</footer>

  <!-- Botones flotantes -->
  <div class="fab" aria-label="Controles">
    <button class="chip" id="theme">üé® Cambiar color</button>
    <button class="chip" id="toggleHearts">‚ú® Corazones</button>
    <!-- Bot√≥n del cup√≥n -->
    <button class="chip" id="btn-cupon" aria-haspopup="dialog" aria-controls="cupon-modal">üé´ Ver cupon de makis</button>
  </div>

  <!-- Overlay de mega explosion -->
  <div class="mega-burst" id="megaBurst" aria-hidden="true"></div>

  <!-- ===== Modal del cupon ===== -->
  <div id="cupon-modal" class="cupon-modal" role="dialog" aria-modal="true" aria-labelledby="cupon-title" aria-hidden="true">
    <div class="cupon-dialog" id="cuponDialog">
      <button class="cupon-close" type="button" aria-label="Cerrar">√ó</button>

      <header class="cupon-header">
        <span class="cupon-chip">Cupon de amor</span>
        <h2 id="cupon-title">Cupon para unos makis de maracuya</h2>
        <p class="cupon-sub">Valido hoy y manana</p>
      </header>

      <section class="cupon-body" id="cuponBody">
        <ul class="cupon-perks">
          <li>üç£ Makis</li>
          <li>ü´∂ Mirada tierna incluida</li>
          <li>üíå Abrazo extra</li>
        </ul>

        <div class="cupon-valid">
          <span class="cupon-tag">Valido:</span>
          <span class="cupon-date">Hoy: <strong id="hoy"></strong></span>
          <span class="cupon-date">Manana: <strong id="manana"></strong></span>
        </div>

        <div class="cupon-serial">Serie: MK-<span id="serie"></span></div>

        <!-- üîí Desbloqueo -->
        <div class="unlock" id="unlockPanel">
          <button class="unlock-btn" id="unlockBtn" aria-label="Tocar para desbloquear">
            <span class="lock" aria-hidden="true"></span>
          </button>
          <div>
            <div class="unlock-note">Toca el candado para desbloquear el c√≥digo üíù</div>
            <div class="unlock-hint">Peque√±o ritual secreto antes del canje üòâ</div>
          </div>
        </div>

        <!-- Caja del codigo (aparece luego del canje) -->
        <div class="cupon-code" id="codeBox" aria-live="polite">
          <h3>Tu codigo secreto üíó</h3>
          <div class="code-row">
            <input class="code-input" id="codeText" readonly value="TeAmoDaMemiMAkiporfiTOnoTO" />
            <button class="copy-btn" id="copyCode" type="button">Copiar</button>
          </div>
          <!-- frase secreta -->
          <p class="secret" id="secretPhrase">‚ÄúCuando digo <b>maracuy√°</b>, t√∫ dices <b>makis</b>.‚Äù ü•≠üç£ (solo nosotros entendemos) </p>
        </div>
      </section>

      <footer class="cupon-actions">
        <button class="cupon-primary" type="button" id="btn-canjear" disabled>Canjear ahora</button>
      </footer>

      <!-- Interfaz de compartir (aparece tras la explosion) -->
      <section class="share-screen" id="shareScreen">
        <h3 class="share-title">Manda este codigo a la persona que amas para que canjees tus makis</h3>
        <p class="share-sub">Copia el codigo o envialo por WhatsApp üíû</p>
        <div class="code-row" style="justify-content:center; margin-bottom:10px;">
          <input class="code-input" id="shareCode" readonly value="TeAmoDaMemiMAkiporfiTOnoTO" />
          <button class="copy-btn" id="shareCopy" type="button">Copiar</button>
        </div>
        <div class="share-actions">
          <!-- Solo WhatsApp y Volver -->
          <button class="share-btn whatsapp" id="shareWhats" aria-label="Compartir por WhatsApp">
            <!-- Logo oficial (SVG) -->
            <svg viewBox="0 0 32 32" aria-hidden="true">
              <path fill="#fff" d="M19.59 17.83c-.29-.15-1.7-.84-1.96-.94-.26-.1-.45-.15-.64.15-.19.29-.74.94-.91 1.13-.17.19-.34.21-.63.08-.29-.15-1.23-.45-2.34-1.44-.86-.75-1.44-1.68-1.61-1.98-.17-.29-.02-.45.13-.6.13-.13.29-.34.45-.51.15-.17.19-.29.29-.49.1-.19.05-.36-.02-.51-.07-.15-.64-1.56-.88-2.13-.23-.56-.47-.48-.64-.48h-.55c-.19 0-.49.07-.75.36-.26.29-1 1-1 2.45 0 1.44 1.02 2.84 1.17 3.04.15.19 2 3.06 4.84 4.29.68.29 1.2.46 1.6.59.67.21 1.27.18 1.75.11.53-.08 1.7-.69 1.94-1.36.24-.67.24-1.25.17-1.36-.07-.11-.26-.18-.55-.33zM16.01 5.33c-5.88 0-10.67 4.78-10.67 10.66 0 1.88.5 3.66 1.38 5.2L5.33 26.67l5.6-1.47a10.64 10.64 0 0 0 5.08 1.29c5.87 0 10.66-4.78 10.66-10.66s-4.79-10.5-10.66-10.5zm0 19.2c-1.74 0-3.36-.46-4.77-1.28l-.34-.2-3.32.87.89-3.24-.22-.33a8.62 8.62 0 0 1-1.32-4.6c0-4.77 3.89-8.66 8.66-8.66s8.66 3.89 8.66 8.66-3.89 8.66-8.66 8.66z"/>
            </svg>
            WhatsApp
          </button>
          <button class="share-btn ghost" id="backToCoupon">Volver al cupon</button>
        </div>
      </section>

      <!-- barra fija de WhatsApp (siempre visible en el modal) -->
      <div class="whats-fixed">
        <button class="share-btn whatsapp" id="whatsFixed">
          <svg viewBox="0 0 32 32" aria-hidden="true">
            <path fill="#fff" d="M19.59 17.83c-.29-.15-1.7-.84-1.96-.94-.26-.1-.45-.15-.64.15-.19.29-.74.94-.91 1.13-.17.19-.34.21-.63.08-.29-.15-1.23-.45-2.34-1.44-.86-.75-1.44-1.68-1.61-1.98-.17-.29-.02-.45.13-.6.13-.13.29-.34.45-.51.15-.17.19-.29.29-.49.1-.19.05-.36-.02-.51-.07-.15-.64-1.56-.88-2.13-.23-.56-.47-.48-.64-.48h-.55c-.19 0-.49.07-.75.36-.26.29-1 1-1 2.45 0 1.44 1.02 2.84 1.17 3.04.15.19 2 3.06 4.84 4.29.68.29 1.2.46 1.6.59.67.21 1.27.18 1.75.11.53-.08 1.7-.69 1.94-1.36.24-.67.24-1.25.17-1.36-.07-.11-.26-.18-.55-.33zM16.01 5.33c-5.88 0-10.67 4.78-10.67 10.66 0 1.88.5 3.66 1.38 5.2L5.33 26.67l5.6-1.47a10.64 10.64 0 0 0 5.08 1.29c5.87 0 10.66-4.78 10.66-10.66s-4.79-10.5-10.66-10.5zm0 19.2c-1.74 0-3.36-.46-4.77-1.28l-.34-.2-3.32.87.89-3.24-.22-.33a8.62 8.62 0 0 1-1.32-4.6c0-4.77 3.89-8.66 8.66-8.66s8.66 3.89 8.66 8.66-3.89 8.66-8.66 8.66z"/>
          </svg>
          Enviar por WhatsApp
        </button>
      </div>

      <!-- ===== Mini modal de T√©rminos y Condiciones (dentro del dialog) ===== -->
      <div class="terms-modal" id="termsModal" aria-modal="true" role="dialog" aria-labelledby="termsTitle" aria-hidden="true">
        <div class="terms-dialog" role="document">
          <div class="terms-head">
            <h3 id="termsTitle">T√©rminos y Condiciones</h3>
          </div>
          <div class="terms-body">
            <p>Antes de canjear tu cup√≥n de amor, confirma que le√≠ste los t√©rminos üíó.</p>
            <button class="btn-ghost" id="seeTerms" type="button">Ver t√©rminos y condiciones</button>
            <p style="margin-top:10px; font-size:.9rem; color:#7a4b67;">
              Al aceptar, continuaremos con el canje (explosi√≥n de amor, c√≥digo y todo üòâ).
            </p>
          </div>
          <div class="terms-actions">
            <button class="btn-ghost" id="termsCancel" type="button">Cancelar</button>
            <button class="btn-primary" id="termsAccept" type="button">Acepto y continuar</button>
          </div>
        </div>
      </div>
      <!-- / Mini modal -->
    </div>
  </div>

  <!-- Toast -->
  <div class="tnc-toast" id="tncToast">Solo ser√° v√°lido si son novios üíû</div>

  <!-- üéµ sonidos -->
  <audio id="snd-pop" preload="auto" src="sonidos/pop.mp3"></audio>
  <audio id="snd-sakura" preload="auto" src="sonidos/sakura.mp3"></audio>

  <script>
    // === Corazones de fondo ===
    (function makeHearts(){
      const cont = document.getElementById('hearts');
      const isMobile = matchMedia('(max-width: 600px)').matches;
      const N = isMobile ? 18 : 32;
      for(let i=0;i<N;i++){
        const h = document.createElement('span');
        h.className = 'heart';
        const size = (isMobile?16:18) + Math.random()*16;
        const dur  = 11 + Math.random()*14;
        const delay= -Math.random()*20;
        const x    = Math.random()*100;
        const drift= (Math.random()*160-80);
        h.style.setProperty('--s', size+'px');
        h.style.left = x+'%';
        h.style.animationDuration = dur+'s';
        h.style.animationDelay = delay+'s';
        h.style.setProperty('--dx', drift+'px');
        cont.appendChild(h);
      }
    })();

    // === Cambiar tema + fondo de video ===
    const themes = ['rosa','lila','azul','dorado'];
    const videos = [
      {src:'video/video1.mp4', poster:'imagenes/foto1.png'},
      {src:'video/video2.mp4', poster:'imagenes/foto2.png'},
      {src:'video/video3.mp4', poster:'imagenes/foto3.png'},
      {src:'video/video4.mp4', poster:'imagenes/foto4.png'},
    ];
    let themeIdx = 0;
    document.getElementById('theme').addEventListener('click', ()=>{
      themeIdx = (themeIdx + 1) % themes.length;
      const b = document.body;
      b.dataset.theme = themes[themeIdx];
      const v = document.getElementById('bgVideo');
      const s = document.getElementById('bgSrc');
      const data = videos[themeIdx % videos.length];
      s.src = data.src; v.poster = data.poster;
      v.load(); v.play().catch(()=>{/* silencio si autoplay bloqueado */});
    });

    // === Mostrar/ocultar corazones ===
    document.getElementById('toggleHearts').addEventListener('click', ()=>{
      document.getElementById('hearts').classList.toggle('hide');
    });

    // ========= L√≥gica del cupon + explosion + compartir =========
    (function(){
      const modal = document.getElementById('cupon-modal');
      const dialog = document.getElementById('cuponDialog');
      const openBtn = document.getElementById('btn-cupon');
      const closeBtn = modal.querySelector('.cupon-close');
      const canjearBtn = document.getElementById('btn-canjear');
      const codeBox = document.getElementById('codeBox');
      const codeText = document.getElementById('codeText');
      const copyBtn = document.getElementById('copyCode');
      const body = document.getElementById('cuponBody');
      const mega = document.getElementById('megaBurst');
      const secretPhrase = document.getElementById('secretPhrase');

      // desbloqueo
      const unlockPanel = document.getElementById('unlockPanel');
      const unlockBtn = document.getElementById('unlockBtn');

      // share UI
      const shareScreen = document.getElementById('shareScreen');
      const shareCopy = document.getElementById('shareCopy');
      const shareCode = document.getElementById('shareCode');
      const backToCoupon = document.getElementById('backToCoupon');
      const shareWhats = document.getElementById('shareWhats');
      const whatsFixed = document.getElementById('whatsFixed');

      // sonidos
      const sndPop = document.getElementById('snd-pop');
      const sndSakura = document.getElementById('snd-sakura');

      // T√©rminos & toast
      const termsModal = document.getElementById('termsModal');
      const seeTerms = document.getElementById('seeTerms');
      const termsCancel = document.getElementById('termsCancel');
      const termsAccept = document.getElementById('termsAccept');
      const tncToast = document.getElementById('tncToast');

      function openModal(){
        modal.classList.add('is-open');
        document.body.classList.add('cupon-lock');
        modal.setAttribute('aria-hidden','false');
        canjearBtn.focus();
      }
      function closeModal(){
        modal.classList.remove('is-open');
        document.body.classList.remove('cupon-lock');
        modal.setAttribute('aria-hidden','true');
        openBtn.focus();
      }

      openBtn.addEventListener('click', openModal);
      closeBtn.addEventListener('click', closeModal);
      modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && modal.classList.contains('is-open')) closeModal(); });

      // ===== Cerrar con swipe hacia abajo (m√≥vil) =====
      let startY = null, deltaY = 0;
      dialog.addEventListener('touchstart', (e)=>{ startY = e.touches[0].clientY; deltaY = 0; }, {passive:true});
      dialog.addEventListener('touchmove', (e)=>{ if(startY!==null) deltaY = e.touches[0].clientY - startY; }, {passive:true});
      dialog.addEventListener('touchend', ()=>{
        if(deltaY > 80) closeModal();
        startY = null; deltaY = 0;
      });

      // Fechas sin "√±" (solo dentro del cup√≥n)
      const fmt = new Intl.DateTimeFormat('es-PE', { weekday:'long', day:'2-digit', month:'long', year:'numeric' });
      const now = new Date();
      const manana = new Date(now); manana.setDate(now.getDate()+1);
      const sinEnies = s => s.replaceAll('√±','n').replaceAll('√ë','N');
      document.getElementById('hoy').textContent = sinEnies(fmt.format(now));
      document.getElementById('manana').textContent = sinEnies(fmt.format(manana));

      // Serie
      const pad = n => String(n).padStart(2,'0');
      const serial = now.getFullYear().toString().slice(-2)
        + pad(now.getMonth()+1) + pad(now.getDate())
        + '-' + pad(now.getHours()) + pad(now.getMinutes());
      document.getElementById('serie').textContent = serial;

      // Copiar
      function copy(el, btn){
        el.select?.(); el.setSelectionRange?.(0, 99999);
        (async ()=>{
          try{ await navigator.clipboard.writeText(el.value); }
          catch{ document.execCommand && document.execCommand('copy'); }
          btn.textContent = 'Copiado ‚úî';
          setTimeout(()=> btn.textContent = 'Copiar', 1200);
        })();
      }
      copyBtn.addEventListener('click', ()=> copy(codeText, copyBtn));
      shareCopy.addEventListener('click', ()=> copy(shareCode, shareCopy));

      // ===== Part√≠culas alternadas =====
      const types = ['hearts','confetti','petals'];
      let lastType = -1;
      function nextType(){
        let t;
        do{ t = Math.floor(Math.random()*types.length); }while(t===lastType);
        lastType = t; return types[t];
      }

      function megaExplosion(){
        mega.innerHTML = '';
        mega.classList.add('show');
        const W = window.innerWidth, H = window.innerHeight;
        const cx = W/2, cy = H/2;
        const mode = nextType(); // 'hearts' | 'confetti' | 'petals'
        const COUNT = mode==='confetti' ? 260 : 220;

        for(let i=0;i<COUNT;i++){
          const el = document.createElement('span');
          let cls = '';
          if(mode==='hearts'){ cls = 'burst-heart'; }
          else if(mode==='confetti'){
            cls = 'burst-confetti';
            if(i%4===1) el.classList.add('c2');
            if(i%4===2) el.classList.add('c3');
            if(i%4===3) el.classList.add('c4');
          }else{ cls = 'burst-petal'; }
          el.className = cls;
          el.style.left = cx + 'px';
          el.style.top  = cy + 'px';

          const angle = (Math.PI*2) * Math.random();
          const dist  = 120 + Math.random()* (Math.max(W,H)*0.7);
          const tx = Math.cos(angle) * dist;
          const ty = Math.sin(angle) * dist;

          const delay = Math.random()*120;
          el.style.setProperty('--tx', tx+'px');
          el.style.setProperty('--ty', ty+'px');
          el.style.setProperty('--rot', (Math.random()*360)+'deg');
          el.style.animationDelay = delay+'ms';

          if(mode==='confetti'){
            el.style.width = (6 + Math.random()*6)+'px';
            el.style.height = (10 + Math.random()*10)+'px';
          }
          if(mode==='petals'){
            el.style.transform = `rotate(${(10+Math.random()*30)}deg)`;
          }
          mega.appendChild(el);
        }
        setTimeout(()=> mega.classList.remove('show'), 1400);

        // sonido: pop (corazones/confeti) o sakura (p√©talos)
        try{
          if(mode==='petals'){ sndSakura.currentTime=0; sndSakura.play(); }
          else{ sndPop.currentTime=0; sndPop.play(); }
        }catch(_){}
      }

      // ===== Desbloqueo (candado/heart) =====
      let unlocked = false;
      unlockBtn.addEventListener('click', ()=>{
        unlocked = true;
        unlockBtn.classList.add('open');
        unlockPanel.style.opacity = '0.65';
        canjearBtn.removeAttribute('disabled');
        // peque√±o feedback sonoro
        try{ sndPop.currentTime=0; sndPop.play(); }catch(_){}
      });

      // ====== T√âRMINOS: abrir, ver mensaje y aceptar ======
      function openTerms(){
        termsModal.classList.add('is-open');
        termsModal.setAttribute('aria-hidden','false');
      }
      function closeTerms(){
        termsModal.classList.remove('is-open');
        termsModal.setAttribute('aria-hidden','true');
      }
      // Ver t√©rminos -> muestra toast "Solo ser√° v√°lido si son novios"
      seeTerms.addEventListener('click', ()=>{
        tncToast.classList.add('show');
        setTimeout(()=> tncToast.classList.remove('show'), 1800);
      });
      termsCancel.addEventListener('click', closeTerms);

      // ===== Canjear -> primero muestra T&C; al aceptar contin√∫a canje =====
      let pendingCanje = false;

      document.getElementById('btn-canjear').addEventListener('click', ()=>{
        if(!unlocked) return; // seguridad extra
        pendingCanje = true;
        openTerms(); // abrir t√©rminos antes de avanzar
      });

      // Aceptar t√©rminos: cerrar modal y continuar con el canje real
      termsAccept.addEventListener('click', ()=>{
        closeTerms();
        if(!pendingCanje) return;
        pendingCanje = false;

        canjearBtn.disabled = true;
        canjearBtn.textContent = 'Espera bb (cargando)‚Ä¶';
        canjearBtn.classList.add('loading');

        setTimeout(()=>{
          megaExplosion();
          codeBox.classList.add('show');
          canjearBtn.classList.remove('loading');
          canjearBtn.textContent = 'Listo ‚ù§Ô∏è';

          setTimeout(()=>{
            shareScreen.classList.add('show');
            shareCode.value = codeText.value;
            secretPhrase.style.display = 'block';
          }, 900);
        }, 900);
      });

      // Cerrar t√©rminos con click fuera o Escape
      termsModal.addEventListener('click', (e)=>{ if(e.target === termsModal) closeTerms(); });
      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape' && termsModal.classList.contains('is-open')) closeTerms();
      });

      // ===== Compartir (WhatsApp + volver) =====
      function buildText(){
        return `üç£üíñ CUPON DE AMOR üíñüç£

Codigo secreto: ${shareCode.value}

Dame mis makis bb üòò‚ú®
(porfi)`;
      }
      // Tu numero (sin el signo +)
      const phone = '51934574931';

      function openWhats(){
        const url = `https://wa.me/${phone}?text=${encodeURIComponent(buildText())}`;
        window.open(url, '_blank', 'noopener');
      }
      shareWhats.addEventListener('click', openWhats);
      whatsFixed.addEventListener('click', openWhats);

      backToCoupon.addEventListener('click', ()=>{
        shareScreen.classList.remove('show');
      });
    })();
  </script>
</body>
</html>
